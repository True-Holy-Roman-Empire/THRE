namespace = THRE_Reform_Desire

#Maintenance_event; mainly calculating Religious Membersstates and Their Dev in the HRE
country_event = {
	id = THRE_Reform_Desire.1
	title = THRE_Reform_Desire.1.t
	desc = THRE_Reform_Desire.1.d
	picture = "INVENTION_eventPicture"
	hidden = yes
	is_triggered_only = yes

	trigger = {
		tag = AAA
	}

	immediate = {
		Reset_HRE_Religion_Counting_Variables = yes
		every_country = {
			limit = {
				is_part_of_hre = yes
			}
			ROOT = {
				change_variable = {
					which = HRE_Members_var
					value = 1
				}
			}
			set_variable = {
				which = HRE_Development_var
				value = 0
			}
			export_to_variable = {
				variable_name = HRE_Development_var
				value = total_development
			}
			ROOT = {
				change_variable = {
					which = HRE_Development_var
					which = PREV
				}
			}
			if = {
				limit = {
					NOT = {
						religion = abrahamism
					}
				}
				Count_Religious_Members = { Religion_inp = Non_Abrahamic } 
			}	
			else_if = {
				limit = {
					has_country_flag = catholic_religion_flag
				}
				Count_Religious_Members = { Religion_inp = Catholic }
			}
			else_if = {
				limit = {
					has_country_flag = sunni_religion_flag
				}
				Count_Religious_Members = { Religion_inp = Sunni }
			}
			else_if = {
				limit = {
					has_country_flag = orthodox_religion_flag
				}
				Count_Religious_Members = { Religion_inp = Orthodox }
			}
			else_if = {
				limit = {
					has_country_flag = coptic_religion_flag
				}
				Count_Religious_Members = { Religion_inp = Coptic }
			}
			set_variable = {		#Reset Variable to save space in savefiles
				which = HRE_Development_var
				value = 0
			}
		}
		#Global checks
		Calc_Religious_Percentages = { Religion_inp = Non_Abrahamic }
		Calc_Religious_Percentages = { Religion_inp = Catholic }
		Calc_Religious_Percentages = { Religion_inp = Sunni }
		Calc_Religious_Percentages = { Religion_inp = Orthodox }
		Calc_Religious_Percentages = { Religion_inp = Coptic }
		export_to_variable = {
			variable_name = Reform_Desire_Abrahamic
			value = trigger_value:reform_desire
			who = emperor
		}
		multiply_variable = {		#Multiply by 100 to get on Percentage scale for the Graphing
			which = Reform_Desire_Abrahamic
			value = 100
		}
	}
	option = {
		name = THRE_Reform_Desire.1.opta
		log = "Amount of HRE Members: [Root.HRE_Members_var.GetValue]"
		log = "Total HRE Development: [Root.HRE_Development_var.GetValue]"
		log = "Nations that are not Abrahamic: [Root.HRE_Non_Abrahamic_Memberstates.GetValue]"
		log = "Nations that are not Abrahamic Development: [Root.HRE_Non_Abrahamic_Members_Dev.GetValue]"
		log = "Nations that are not Abrahamic share of HRE Dev: [Root.HRE_Non_Abrahamic_Dev_Percentage.GetValue]"
		log = "Catholic (ABR) Membersstates of HRE: [Root.HRE_Catholic_Memberstates.GetValue]"
		log = "Catholic (ABR) Memberstates Development: [Root.HRE_Catholic_Members_Dev.GetValue]"
		log = "Catholic (ABR) States Share of HRE Dev: [Root.HRE_Catholic_Dev_Percentage.GetValue]"
		log = "Sunni (ABR) Membersstates of HRE: [Root.HRE_Sunni_Memberstates.GetValue]"
		log = "Sunni (ABR) Memberstates Development: [Root.HRE_Sunni_Members_Dev.GetValue]"
		log = "Sunni (ABR) States Share of HRE Dev: [Root.HRE_Sunni_Dev_Percentage.GetValue]"
		log = "Orthodox (ABR) Membersstates of HRE: [Root.HRE_Orthodox_Memberstates.GetValue]"
		log = "Orthodox (ABR) Memberstates Development: [Root.HRE_Orthodox_Members_Dev.GetValue]"
		log = "Orthodox (ABR) States Share of HRE Dev: [Root.HRE_Orthodox_Dev_Percentage.GetValue]"
		log = "Coptic (ABR) Membersstates of HRE: [Root.HRE_Coptic_Memberstates.GetValue]"
		log = "Coptic (ABR) Memberstates Development: [Root.HRE_Coptic_Members_Dev.GetValue]"
		log = "Coptic (ABR) States Share of HRE Dev: [Root.HRE_Coptic_Dev_Percentage.GetValue]"
		log = "Abrahamic Reform Desire: [Root.Reform_Desire_Abrahamic.GetValue]"
	}
	after = {
		if = {
			limit = {
				emperor = {
					has_country_flag = already_demanded_abr_conversion_this_year
				}
			}
			emperor = {
				clr_country_flag = already_demanded_abr_conversion_this_year
			}
		}
	}
}

country_event = {
	id = THRE_Reform_Desire.2
	title = THRE_Reform_Desire.2.t
	desc = THRE_Reform_Desire.2.d
	picture = "COURT_eventPicture"
	is_triggered_only = yes
	major = yes
	trigger = {		#Failsafe
		is_part_of_hre = yes
		NOT = {
			has_global_flag = THRE_Great_Schism
		}
		NOT = {
			religion = abrahamism
		}
	}
	option = {
		name = THRE_Reform_Desire.2.opta 		#Alright then
		change_religion = abrahamism
		add_prestige = -10
		add_imperial_influence = 1
		ai_chance = {
			factor = 10
		}
	}
	option = {
		name = THRE_Reform_Desire.2.opta		#Nope
		add_reform_desire = 0.005
		add_imperial_influence = -2
		emperor = {
			add_casus_belli = {
				type = cb_force_abrahamism_empire
				target = ROOT
			}
		}
		hidden_effect = {
			set_country_flag = Refused_Convert_Abrahamism_Demanded_By_Emperor
		}
		ai_chance = {
			factor = 10
		}
	}
}

country_event = {
	id = THRE_Reform_Desire.3
	title = THRE_Reform_Desire.3.t
	desc = THRE_Reform_Desire.3.d
	picture = "COURT_eventPicture"
	is_triggered_only = yes
	major = yes

	trigger = {
		is_emperor = yes	#failsafe
		NOT = { has_global_flag = THRE_Great_Schism }
	}

	immediate = {
		Add_Scaled_Abrahamic_Reform_Desire = yes
	}

	option = {
		name = THRE_Reform_Desire.3.opta
		Add_Scaled_Abrahamic_Reform_Desire = yes
	}
}

country_event = {			#The Great Schism
	id = THRE_Reform_Desire.4
	title = THRE_Reform_Desire.4.t
	desc = THRE_Reform_Desire.4.d
	picture = "COURT_eventPicture"
	major = yes
	fire_only_once = yes
	trigger = {
		is_emperor = yes
		NOT = { has_global_flag = THRE_Great_Schism }
		reform_desire = 1
	}

	mean_time_to_happen = {
		months = 6
	}
	immediate = {
		hidden_effect = {	
			log = "The Great Schism Happened"
		}	
	}

	option = {
		name = THRE_Reform_Desire.4.opta		#Declare the Council of Constaninople void
		hidden_effect = {
			great_schism_effect = yes
			set_global_flag = THRE_Emperor_Enforced_Faith
		}
		THRE_Make_Root_Religion_Official_HRE = yes
		ai_chance = {
			factor = 90
		}
	}

	option = {
		name = THRE_Reform_Desire.4.optb 		#Try to preserve the peace
		hidden_effect = {
			great_schism_effect = yes
			set_global_flag = THRE_Emperor_Tried_Preserve_Peace
		}
		ai_chance = {
			factor = 10
		}
	}
	after = {
		random_country = {
			limit = {
				NOT = {
					religion = emperor
				}
				is_part_of_hre = yes
				OR = {
					religion = catholic
					religion = sunni
					religion = orthodox
				}
			}
			country_event = {
				id = THRE_Reform_Desire.5
				days = 5
			}
		}
	}
}

country_event = {			#Protestation 
	id = THRE_Reform_Desire.5
	title = THRE_Reform_Desire.5.t
	desc = {
		trigger = {
			has_global_flag = THRE_Emperor_Enforced_Faith
		}
		desc = THRE_Reform_Desire.5.desca 
	}
	desc = {
		trigger = {
			has_global_flag = THRE_Emperor_Tried_Preserve_Peace
		}
		desc = THRE_Reform_Desire.5.descb
	}
	
	picture = "COURT_eventPicture"
	is_triggered_only = yes
	major = yes

	trigger = {
		has_global_flag = THRE_Great_Schism
		OR = {
			has_global_flag = THRE_Emperor_Enforced_Faith
			has_global_flag = THRE_Emperor_Tried_Preserve_Peace
		}
	}

	option = {
		name = THRE_Reform_Desire.5.opta		#Lets gooooo!
		emperor = {
			THRE_Make_Root_Religion_Official_HRE = yes
		}
		enable_hre_leagues = yes
		THRE_Make_Root_Religion_Form_League = yes
		add_prestige = 25
		hidden_effect = {
			set_global_flag = THRE_First_League_War
		}
		ai_chance = {
			factor = 90
		}
	}

	option = {
		name = THRE_Reform_Desire.5.optb	#Nah we skip this
		add_prestige = -25
		hidden_effect = {
			random_country = {
				limit = {
					NOT = {
						religion = emperor
					}
					is_part_of_hre = yes
					OR = {
						religion = catholic
						religion = sunni
						religion = orthodox
					}
				}
				country_event = {
					id = THRE_Reform_Desire.5
					days = 5
				}
			}
		}
		ai_chance = {
			factor = 10
		}
	}
}